<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"                
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./../../../../../template/masterPage.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="menuHorizontal">
        <ui:include src="./../../../../menuHorizontalDiag.xhtml"/>
    </ui:define>

    <ui:define name="menuLateral">
        <ui:include src="./../../../../menuLateralDiag.xhtml"/>
    </ui:define>

    <ui:define name="center">
        <h2>Gestão de Testes de Compatibilidade do Paciente: 
            #{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.nome} 
            #{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.nomeDoMeio}
            #{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.sobreNome}
        </h2>

        <h:form id="formVisualizarGeral">
            <center>
                <p:growl sticky="true" id="ms" autoUpdate="true"/>
            </center>

            <br/>
            <br/>

            <p:tabView id="tabVisualizar" style="height: 70%">

                <p:tab title="Dados do Paciente">
                    <p:tabView id="tabDadosCandidatos" style="height: 70%">
                        <p:tab title="Dados Pessoais">
                            <h:panelGrid columns="2" cellpadding="4">
                                <h3>Nome Completo: </h3>
                                <h:panelGroup>
                                    #{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.nome} 
                                    #{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.nomeDoMeio}
                                    #{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.sobreNome}
                                </h:panelGroup>

                                <h3>Data de Nascimento: </h3>
                                <h:outputText style="border: none" value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.dataNascimento}">
                                    <f:convertDateTime pattern="dd-MM-yyyy"/>
                                </h:outputText>
                                <h3>Sexo: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdSexo.descricao}"/>
                                <h3>Nacionalidade: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdNacionalidade.nomePais}"/>
                                <h3>Estado Civil: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdEstadoCivil.descricao}"/>
                            </h:panelGrid>
                        </p:tab>
                        <p:tab title="Filiação">
                            <h:panelGrid columns="2" cellpadding="7">
                                <h3>Nome do Pai: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.nomePai}"/>
                                <h3>Nome da Mãe: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.nomeMae}"/>
                            </h:panelGrid>
                        </p:tab>
                        <p:tab title="Contacto">
                            <h:panelGrid columns="2" cellpadding="7">
                                <h3>Telefone 1: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdContacto.telefone1}"/>
                                <h3>Telefone 2: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdContacto.telefone2}"/>
                                <h3>Email 1: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdContacto.email1}"/>
                                <h3>Email 2: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdContacto.email2}"/>
                            </h:panelGrid>
                        </p:tab>
                        <p:tab title="Endereço">
                            <h:panelGrid columns="2" cellpadding="7">
                                <h3>País: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdEndereco.fkIdComuna.fkIdMunicipio.fkIdProvincia.fkIdPais.nomePais}"/>
                                <h3>Província: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdEndereco.fkIdComuna.fkIdMunicipio.fkIdProvincia.nomeProvincia}"/>
                                <h3>Município: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdEndereco.fkIdComuna.fkIdMunicipio.nomeMunicipio}"/>
                                <h3>Distrito: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdEndereco.fkIdDistrito.descricao}"/>
                                <h3>Comuna: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdEndereco.fkIdComuna.descricaoComuna}"/>
                                <h3>Bairro: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdEndereco.bairro}"/>
                                <h3>Rua: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdEndereco.rua}"/>
                                <h3>Nº Casa: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdEndereco.numeroCasa}"/>
                            </h:panelGrid>
                        </p:tab>
                        <p:tab title="Outros Dados">
                            <h:panelGrid columns="2" cellpadding="7">
                                <h3>Religião: </h3>
                                <p:outputLabel value="#{diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade.fkIdPessoa.fkIdReligiao.descricao}"/>
                            </h:panelGrid>
                        </p:tab>
                    </p:tabView>
                </p:tab>

                <p:tab title="Tipagem Sanguínea">


                    <c:if test="${diagTipagemDoenteBean.pacienteJaTipado(diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade) == true}">


                        <h:panelGrid columns="2" cellpadding="7">

                            <h3>Data: 
                                <h:outputText value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.dataTipagem}">
                                    <f:convertDateTime pattern="dd/MM/yyyy - HH:mm"/>
                                </h:outputText>

                            </h3>

                            <h3>Anti-A: </h3>
                            <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.antiA}"/>

                            <h3>Anti-B: </h3>
                            <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.antiB}"/>

                            <h3>Anti-AB: </h3>
                            <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.antiAb}"/>

                            <h3>Anti-D: </h3>
                            <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.antiD}"/>

                            <h3>Du (D fraco): </h3>
                            <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.du}"/>

                            <h3>A1: </h3>
                            <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.a1}"/>

                            <h3>B: </h3>
                            <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.b}"/>

                            <h3>O: </h3>
                            <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.o}"/>

                            <h3>Grupo Sanguíneo: </h3>
                            <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.conclusao.descricaoGrupoSanguineo}"/>

                            <h3>Realizado Por: </h3>
                            <h:panelGroup>
                                <h:outputText value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.fkRealizadoPor.fkIdPessoa.nome}"/>
                                #{" "}
                                <h:outputText value="#{diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar.fkRealizadoPor.fkIdPessoa.sobreNome}"/>
                            </h:panelGroup>

                        </h:panelGrid>

                    </c:if>

                    <c:if test="${diagTipagemDoenteBean.pacienteJaTipado(diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade) == false}">
                        <center>

                            <h2>Este paciente ainda não foi tipado.</h2>

                        </center>
                    </c:if>

                </p:tab>

                <p:tab title="Histórico de Testes de Compatibilidade">

                    <c:if test="${diagTipagemDoenteBean.pacienteJaTipado(diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade) == true}">
                        <h:panelGrid columns="2">
                            <p:commandButton icon="ui-icon-plus" value="Adicionar Testes de Compatibilidade" action="#{diagAdicionarTesteCompatibilidadeBean.redirecionarAdicionarTesteCompatibilidade(diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade, diagTesteCompatibilidadeBean.diagTipagemDoenteVisualizar)}"/>
                        </h:panelGrid>

                        <p:dataTable id="datatableTriagens" var="teste" 
                                     value="#{diagTesteCompatibilidadeBean.findDistinctTesteCompatibilidadeByPaciente(diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade)}" 
                                     rows="5" paginator="true" paginatorPosition="bottom"
                                     emptyMessage="Não há registos de testes de compatibilidade.">

                            <p:column headerText="Data do Teste">
                                <center>
                                    <h:outputText value="#{teste.data}">
                                        <f:convertDateTime pattern="dd/MM/yyyy - HH:mm"/>
                                    </h:outputText>
                                </center>
                            </p:column>

                            <p:column headerText="Cód. Dador">
                                <center>
                                    <h:outputText value="#{teste.fkIdBolsaSangue.fkIdCandidatoDador.codigoCandidatoDador}"/>
                                </center>
                            </p:column>

                            <p:column headerText="Dador">
                                <center>
                                    <h:outputText value="#{teste.fkIdBolsaSangue.fkIdCandidatoDador.fkIdPessoa.nome} #{teste.fkIdBolsaSangue.fkIdCandidatoDador.fkIdPessoa.sobreNome} "/>
                                </center>
                            </p:column>

                            <p:column headerText="Resultado do Teste" filterBy="#{teste.fkIdResultadoTesteCompatibilidade.descricao}">
                                <center>
                                    <h:outputText value="#{teste.fkIdResultadoTesteCompatibilidade.descricao}"/>
                                </center>
                            </p:column>

                            <p:column>
                                <center>
                                    <p:commandButton value="Visualizar" action="#{diagTesteCompatibilidadeBean.selecionarTesteCompatibilidadeVisualizar(teste)}" 
                                                     onclick="PF('dialogVisualizarTeste').show();" icon="ui-icon-info" 
                                                     update=":formVisualizarTeste" process="@this"/>
                                </center>
                            </p:column>

                        </p:dataTable>
                    </c:if>

                    <c:if test="${diagTipagemDoenteBean.pacienteJaTipado(diagTesteCompatibilidadeBean.admsPacienteVisualizarTesteCompatibiladade) == false}">
                        <center>

                            <h2>Este paciente ainda não foi tipado e não podem ser efectuados testes de compatibilidade.</h2>

                        </center>
                    </c:if>

                </p:tab>

            </p:tabView>

            <br/>
            <center>
                <p:commandButton style=" font-size:medium" process="@this" value="Voltar" icon="ui-icon-arrowreturnthick-1-w" action="#{diagTesteCompatibilidadeBean.voltarParaPesquisa()}"/>
            </center>
            <br/>
        </h:form>

        <p:dialog header="Visualizar Teste de Compatibilidade" closable="false" showEffect="fade"
                  widgetVar="dialogVisualizarTeste" modal="true"
                  height="30%" width="30%"
                  style="font-size: 16px; font-weight: bold"> 

            <h:form id="formVisualizarTeste">
                <h:panelGrid columns="2" class="float-right">
                    <p:commandButton value="Fechar" onclick="dialogVisualizarExames.hide()" process="@this" style="width: 130px"
                                     action="#{diagTesteCompatibilidadeBean.selecionarTesteCompatibilidadeVisualizar(null)}" />
                </h:panelGrid>

                <p:fieldset style="width: 95%">

                    <h:panelGrid columns="2" cellpadding="4">

                        <h3>Dador: </h3>
                        <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTesteCompatibilidadeVisulaizar.fkIdBolsaSangue.fkIdCandidatoDador
                                                .fkIdPessoa.nome} #{diagTesteCompatibilidadeBean.diagTesteCompatibilidadeVisulaizar.fkIdBolsaSangue.
                                                fkIdCandidatoDador.fkIdPessoa.sobreNome}"/>

                        <h3>Data do Teste: </h3>
                        <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTesteCompatibilidadeVisulaizar.data}">
                            <f:convertDateTime pattern="dd/MM/yyyy - HH:mm"/>
                        </p:outputLabel>

                        <h3>Teste Coombs: </h3>
                        <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTesteCompatibilidadeVisulaizar.testeCoombs}"/> 

                        <h3>Prova Soro Fisiologico: </h3>
                        <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTesteCompatibilidadeVisulaizar.provaSoroFisiologico}"/> 

                        <h3>Resultado: </h3>
                        <p:outputLabel value="#{diagTesteCompatibilidadeBean.diagTesteCompatibilidadeVisulaizar.fkIdResultadoTesteCompatibilidade.descricao}"/> 

                    </h:panelGrid>
                </p:fieldset>

            </h:form>
        </p:dialog>


    </ui:define>

</ui:composition>
